<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ezequiel & √ârika</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
  <div class="hearts" id="hearts-container"></div>

  <div class="container">
    <div class="foto">
      <img id="foto-aleatoria" src="img/foto1.jpg" alt="Nossa foto" />
      <div class="photo-hearts" id="photo-hearts-container"></div>
    </div>
    <h2>Juntos</h2>
    <h2 id="tempo">Carregando tempo...</h2>
    <hr class="separador">
    <div class="amor">Que essa contagem seja pra sempre um lembrete da melhor decis√£o que j√° tomei‚Ä¶ E que a gente possa voltar aqui e ver que os dias s√≥ aumentaram, junto com o nosso amor. Eu te amo eternamente, meu amor. ‚ù§Ô∏è</div>
    <hr class="separador">
    <h2>Nossa M√∫sica</h2>
    <!-- Controles de √°udio e ondas sonoras -->
    <div class="audio-controls">
      <button id="toggle-btn">‚è∏</button>
      <div class="sound-waves" id="sound-waves">
        <span></span><span></span><span></span><span></span>
      </div>
    </div>

    <!-- √ÅUDIO -->
    <audio id="background-music" autoplay loop>
      <source src="mp3/meusonho.mp3" type="audio/mpeg">
      Seu navegador n√£o suporta o elemento de √°udio.
    </audio>
  </div>

  <script>
    // Gerar lista de 50 imagens
    const imagens = Array.from({ length: 50 }, (_, i) => `img/foto${i + 1}.jpg`);
    let imagensSequencia = [];
    let indiceImagemAtual = 0;
    let historicoImagens = ['img/foto1.jpg'];
    let indiceHistorico = 0;
    let intervaloTroca;
    const fotoElement = document.getElementById('foto-aleatoria');
    const audio = document.getElementById('background-music');
    const toggleBtn = document.getElementById('toggle-btn');
    const soundWaves = document.getElementById('sound-waves');
    const fotoContainer = document.querySelector('.foto');

    // Preload de imagens
    function preloadImagens(imagens) {
      imagens.forEach(src => {
        const img = new Image();
        img.src = src;
        img.onerror = () => console.warn(`Falha ao preload: ${src}`);
      });
    }

    // Embaralhar array (Fisher-Yates)
    function embaralhar(array) {
      const novoArray = [...array];
      for (let i = novoArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [novoArray[i], novoArray[j]] = [novoArray[j], novoArray[i]];
      }
      return novoArray;
    }

    // Criar sequ√™ncia fixa de imagens
    function criarSequenciaImagens() {
      const imagensRestantes = imagens.slice(1);
      const imagensAleatorias = embaralhar(imagensRestantes);
      imagensSequencia = ['img/foto1.jpg', ...imagensAleatorias];
      preloadImagens(imagensSequencia); // Preload ap√≥s criar sequ√™ncia
    }

    // Carregar pr√≥xima imagem
    function carregarProximaImagem() {
      indiceImagemAtual = (indiceImagemAtual + 1) % imagensSequencia.length;
      const imagem = imagensSequencia[indiceImagemAtual];
      fotoElement.classList.add('fade');
      setTimeout(() => {
        fotoElement.src = imagem;
        fotoElement.classList.remove('fade');
        historicoImagens.push(imagem);
        indiceHistorico = historicoImagens.length - 1;
      }, 500); // Aumentado para 500ms
    }

    // Carregar imagem do hist√≥rico
    function carregarImagemHistorico(indice) {
      if (indice >= 0 && indice < historicoImagens.length) {
        fotoElement.classList.add('fade');
        setTimeout(() => {
          fotoElement.src = historicoImagens[indice];
          fotoElement.classList.remove('fade');
          indiceHistorico = indice;
          indiceImagemAtual = imagensSequencia.indexOf(historicoImagens[indice]);
        }, 500);
      }
    }

    // Lidar com erro de imagem
    fotoElement.onerror = () => {
      console.warn('Erro ao carregar imagem, revertendo para foto1.jpg');
      fotoElement.src = 'img/foto1.jpg';
    };

    // Iniciar troca autom√°tica
    function iniciarTrocaAutomatica() {
      clearInterval(intervaloTroca);
      intervaloTroca = setInterval(carregarProximaImagem, 2500); // Aumentado para 2500ms
    }

    // Navega√ß√£o por gestos
    let touchStartX = 0;
    let touchEndX = 0;
    let lastTap = 0;

    fotoContainer.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });

    fotoContainer.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      const currentTime = new Date().getTime();
      const tapInterval = currentTime - lastTap;

      if (tapInterval < 300 && tapInterval > 0) {
        iniciarEfeitoFoto();
      } else {
        handleSwipe();
      }

      lastTap = currentTime;
    });

    function handleSwipe() {
      clearInterval(intervaloTroca);
      const swipeDistance = touchEndX - touchStartX;
      if (swipeDistance > 50 && indiceHistorico > 0) {
        carregarImagemHistorico(indiceHistorico - 1);
      } else if (swipeDistance < -50) {
        carregarProximaImagem();
      }
      iniciarTrocaAutomatica();
    }

    // Controle de √°udio
    function updateButtonState() {
      toggleBtn.innerHTML = audio.paused ? '‚ñ∂' : '‚è∏';
      soundWaves.style.display = audio.paused ? 'none' : 'flex';
    }

    toggleBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.play().then(updateButtonState).catch(error => console.error('Erro ao tocar √°udio:', error));
      } else {
        audio.pause();
        updateButtonState();
      }
    });

    audio.addEventListener('play', updateButtonState);
    audio.addEventListener('pause', updateButtonState);
    audio.addEventListener('ended', updateButtonState);

    // Contador de tempo
    const dataInicial = new Date(2024, 4, 10, 19, 38, 0);

    function calcularDiferenca(dataInicial, dataAtual) {
      let anos = dataAtual.getFullYear() - dataInicial.getFullYear();
      let meses = dataAtual.getMonth() - dataInicial.getMonth();
      let dias = dataAtual.getDate() - dataInicial.getDate();
      let horas = dataAtual.getHours() - dataInicial.getHours();
      let minutos = dataAtual.getMinutes() - dataInicial.getMinutes();
      let segundos = dataAtual.getSeconds() - dataInicial.getSeconds();

      if (segundos < 0) { segundos += 60; minutos--; }
      if (minutos < 0) { minutos += 60; horas--; }
      if (horas < 0) { horas += 24; dias--; }
      if (dias < 0) {
        const mesAnterior = new Date(dataAtual.getFullYear(), dataAtual.getMonth(), 0).getDate();
        dias += mesAnterior;
        meses--;
      }
      if (meses < 0) { meses += 12; anos--; }

      return { anos, meses, dias, horas, minutos, segundos };
    }

    function atualizarTempo() {
      const agora = new Date();
      const tempo = calcularDiferenca(dataInicial, agora);
      document.getElementById("tempo").innerText = 
        `${tempo.anos} anos, ${tempo.meses} meses, ${tempo.dias} dias\n` +
        `${tempo.horas} horas, ${tempo.minutos} minutos e ${tempo.segundos} segundos`;
    }

    setInterval(atualizarTempo, 1000);
    atualizarTempo();

    // Cora√ß√µes animados no fundo
    function criarCoracao() {
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.style.left = `${Math.random() * 100}%`;
      heart.style.animationDuration = `${4 + Math.random() * 4}s`;
      document.getElementById("hearts-container").appendChild(heart);
      setTimeout(() => heart.remove(), 8000);
    }

    setInterval(criarCoracao, 300);

    // Emoticons de cora√ß√µes na foto
    const emoticons = ['‚ù§Ô∏è', 'üíñ', 'üíï', 'üíò', 'üíû'];
    function criarCoracaoFoto() {
      const heart = document.createElement("div");
      heart.className = "photo-heart";
      heart.innerHTML = emoticons[Math.floor(Math.random() * emoticons.length)];
      heart.style.left = `${Math.random() * 100}%`;
      heart.style.animationDuration = `${2 + Math.random() * 2}s`;
      document.getElementById("photo-hearts-container").appendChild(heart);
      setTimeout(() => heart.remove(), 4000);
    }

    function iniciarEfeitoFoto() {
      const intervalo = setInterval(criarCoracaoFoto, 200);
      setTimeout(() => clearInterval(intervalo), 5000);
    }

    // Inicializa√ß√£o
    window.onload = () => {
      criarSequenciaImagens();
      iniciarTrocaAutomatica();
      iniciarEfeitoFoto();
      soundWaves.style.display = 'none';
      const playPromise = audio.play();
      if (playPromise !== undefined) {
        playPromise.then(updateButtonState).catch(updateButtonState);
      }
    };
  </script>
</body>
</html>
